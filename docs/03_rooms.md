# 03. ルーム機能（1ルーム固定、将来拡張可）

## 概要

MVP段階では**1つのルームのみ**を提供し、将来的にマルチルーム対応を可能にする設計。

## 現在の仕様

### ルーム制限

- **ルーム数**：1つのみ（例：`"main-room"`）
- **同時接続数**：最大5人まで
- **アクセス制御**：誰でも入室可能（認証不要）

### 同時接続数制限

#### 仕組み

- **Supabase Realtime Presence**を利用してリアルタイム監視
- クライアント数カウントによる入室制御

#### フロー

1. 入室前にPresenceチャンネルに接続
2. 現在の`presenceState`から人数をカウント
3. **5人未満**：入室許可
4. **5人以上**：「満員です（5/5）」を表示し入室拒否

## 将来の拡張性

### データベース設計

```sql
-- roomsテーブルを用意（現在は1レコードのみ利用）
rooms
- id          uuid (PK)
- name        text        -- "main-room"
- description text        -- ルームの説明
- created_at  timestamp
```

### 拡張時の追加機能

1. **ルーム作成画面**：新規ルーム作成UI
2. **ルーム一覧画面**：既存ルーム一覧・選択UI
3. **ルーム設定**：最大人数、プライベート/パブリック等

## 実装のポイント

### MVP段階

- `main-room`の固定IDをアプリ側でハードコード
- シンプルな入室制御（5人制限のみ）
- ルーム管理UIは不要
- **ルーティング**: `/room/main-room`の固定URL

### 将来対応

- ルームIDを動的に扱うよう設計変更
- ルーム管理機能の段階的追加  
- マルチルーム対応のプレゼンス管理
- **ルーティング拡張**: `/room/:room_id`による動的ルーム対応

## ルーティング仕様

### 現在（MVP）

- **ルーム画面**: `/room/main-room`（固定）
- **アクセス方法**: 入室準備モーダルから自動遷移

### 将来（拡張時）

- **ルーム画面**: `/room/:room_id`（動的）
- **ルーム一覧**: `/rooms`（新規追加）
- **ルーム作成**: `/rooms/create`（新規追加）

## 技術詳細

### Presenceチャンネル

- チャンネル名：`room:{room_id}`
- 監視対象：接続中クライアント数
- リアルタイム更新：入退室の即座な反映

### 厳密な制御（将来）

より厳密な人数制限が必要になった場合：

- `room_members`テーブルでの入退室記録
- `COUNT(*)`ベースでの制御
- セッションタイムアウト管理

# 04. ユーザーフロー（ログインから入室まで）

## 概要

ユーザーがアプリにアクセスしてからルームに入室するまでのUI・UXフローを定義する。

## 画面構成

### 1. トップページ（ランディング）

#### レイアウト

以下のFigmaデザインを参考にする。
https://www.figma.com/design/vES3VewH8Qo1MA0Au0oujK/Supabase-Gather?node-id=23-2&t=h312ToASd1B6kW07-0

### 2. 入室準備モーダル

#### レイアウト

以下のFigmaデザインを参考にする。
https://www.figma.com/design/vES3VewH8Qo1MA0Au0oujK/Supabase-Gather?node-id=23-59&t=h312ToASd1B6kW07-0

#### 表示タイミング

- **必須**：入室ボタン押下後に毎回表示
- 認証方式に関わらず共通のモーダル

#### 入力項目

**表示名設定**

- 入力フィールド：テキスト入力
- **Googleユーザー**：`profiles.name`を初期値として表示・編集可能
- **ゲストユーザー**：空または`"ゲスト1234"`のような初期値

**アバター選択**

- クリック選択式（ラジオボタン的動作）

#### アクション

- **入室ボタン**：設定完了後にルーム画面へ遷移
- **キャンセル**：トップページに戻る

### 3. ルーム画面（メイン）

#### レイアウト

以下のFigmaデザインを参考にする。
https://www.figma.com/design/vES3VewH8Qo1MA0Au0oujK/Supabase-Gather?node-id=23-162&t=h312ToASd1B6kW07-0

#### 各エリアの詳細

**上部バー**

- ルーム名表示（例：「メインルーム」）
- 接続人数（例：「3 / 5」）
- 満員時は赤色表示

**左側：2Dスペース**

- アバター移動可能エリア
- クリックまたはキーボードで移動
- 他ユーザーのアバターもリアルタイム表示

**右側：チャット**

- メッセージ一覧（スクロール可能）
- メッセージ入力フィールド
- 送信ボタン

## ユーザーフロー詳細

### Google認証フロー

1. 「Googleでログイン」ボタンクリック
2. Google OAuth画面表示
3. 認証成功後、入室準備モーダル表示
4. 設定完了後、ルーム画面表示

### ゲスト認証フロー

1. 「ゲストとして入室」ボタンクリック
2. 即座に入室準備モーダル表示
3. 設定完了後、ルーム画面表示

### 設定変更フロー

1. ルーム画面の「設定を変更」ボタンクリック
2. 入室準備モーダル再表示（現在設定が初期値）
3. 変更完了後、ルーム画面に戻る

## エラーハンドリング

### 満員時の処理

- 入室準備モーダルで「入室」ボタンを無効化
- 「ルームが満員です（5/5）」メッセージ表示
- 自動的に人数チェックを継続し、空きが出たら有効化

### 接続エラー時の処理

- 再接続を自動試行
- 長時間接続できない場合はトップページに戻す
- エラーメッセージを適切に表示
